<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[CCNA简明笔记 5-地址转换协议、ACL、广域网协议]]></title>
    <url>%2F2018%2F02%2F02%2FCCNA%E7%AE%80%E6%98%8E%E7%AC%94%E8%AE%B0-5%2F</url>
    <content type="text"><![CDATA[前言 地址转换协议（NAT和PAT）；ACL的定义、分类和配置；广域网协议HDLC和PPP。 1. ACL定义ACL：access control list，访问控制列表，用来对访问流量进行控制的安全技术。 分类标准ACL1R1(config)#access-list 99 permit 172.16.10.0 0.0.0.255 99 访问列表序列号，标准acl序列号范围1-99.标准ACL情况下，路由器收到数据包，基于数据包的源IP先匹配ACL进行过滤，再依据目的ip匹配路由表.0.0.0.255 反向掩码，0匹配，1不匹配；若172.168.10.100 精确匹配，反掩码应该是 0.0.0.0（可先掩码255.255.255.255后反向掩码得到），可用host简写为：1R1(config)#access-list 99 permit host 172.168.10.100 反掩码计算172.16.0.0/12 子网掩码 172.11110000.0.0 -&gt;反向掩码0.15.255.255 ACL匹配顺序123R1(config)#access-list 99 permit 172.16.10.0 0.0.0.255R1(config)#access-list 99 deny 172.16.10.0 0.0.0.255R1(config)#access-list 99 permit 172.16.30.0 0.0.0.255 匹配原则是：从上至下优先匹配，末尾隐含拒绝所有（access-list 99 deny any），标准ACL和扩展ACL都适用。 扩展ACL1R1(config)#access-list 199 permit tcp 172.16.10.0 0.0.0.255 eq 8080 host 172.16.20.1 eq 80 扩展ACL序列号范围：100-199扩展ACL，过滤数据包的protocol，src-ip，src-port，dst-ip，dst-port（五元组）。发出的数据包一般源端口大于1023，目标端口小于1023的固定端口。tcp是指三层数据包中的protocol字段，tcp=6，udp=1712R1(config)#access-list 199 permit ip any any/*允许所有*/ ip指TCP/IP所有协议123456R1(config)#access-list 199 deny tcp 172.16.10.0 0.0.0.255 eq 8080 host 172.16.20.1 eq 80access-list 199 deny tcp 172.16.20.0 0.0.0.255 eq 8080 host 172.16.20.1 eq 80access-list 199 deny tcp 172.16.30.0 0.0.0.255 eq 8080 host 172.16.20.1 eq 80access-list 199 permit ip any any /*前面是deny的acl，末尾要添加permit ip any any*/ 生效必须应用到端口，并指定方向（in，out），因此实际应用要考虑数据包的发出和回包两个方向是否有影响（回包是源目ip和port对调）。12R1(config)#int eth 0/0R1(config-if)#ip access-group 199 out 只有在接口下应用的ACL才是对数据包起过滤的作用。不同位置调用ACL，其作用不同，不一定是过滤数据包，比如如下的地址转换时调用ACL。 2. 地址转换协议NAT：network address translation 网络地址转译。主要作用，缓解内部网络访问外部网络地址不够用的情况，也起到隐藏内部地址的作用。分为静态NAT、动态NAT和PAT。 静态NAT静态NAT：就是一对一的NAT，静态NAT的缺点就是每个内网IP要占用一个外网IP，就算这台终端现在处于关闭状态，这个外网IP也被静态分配占用着。 动态NAT动态NAT： 多个私有地址转换成少个公有地址，通信结束后，这个外网IP被释放。10.0.0.1-&gt;200.0.0.1，内部地址被转换后得到171.69.58.80-&gt;200.0.0.110.0.0.1是内部本地地址，171.69.58.80是内部全局地址路由器的 NAT TABLE，记录地址转换映射关系由内访问外，更改源ip地址；由外向内，更改目标ip地址配置12345678910111213141516R1(config)#access-list 99 permit 10.0.0.0 0.255.255.255 /*定义私有地址段*/R1(config)#ip nat pool wxb 171.69.58.80 171.69.56.85 netmask 255.255.255.0 /*定义公有地址段171.69.58.80-171.69.58.85*/R1(config)#ip nat inside source list 99 pool wxb /*在内部本地地址与内部全局地址之间做转换，更改源ip地址*/R1(config)#int e 0/0 R1(config-if)#ip nat inside/*配置成NAT对内接口*/R1(config-if)#exitR1(config)#int s 0/0R1(config-if)#ip nat outside/*配置成NAT对外接口*/R1(config)#show ip nat translation/*查看NAT地址转换表*/ PATPAT：port address translation 端口地址转换，也叫端口地址复用，多个私有地址转换成一个公有地址的多个不同端口号。配置12345678910R1(config)#access-list 99 permit 10.0.0.0 0.255.255.255 /*定义允许转换的内部地址范围*/R1(config)#ip nat inside source list 99 interface s0/0 overload/*ACL中匹配到的私有地址转换为接口s0/0的地址，对应不同端口*//*overload表示端口多路复用*/R1(config)#int e 0/0 告诉路由器方向R1(config-if)#ip nat insideR1(config-if)#exitR1(config)#int s 0/0R1(config-if)#ip nat outside 检验123show ip nat translationclear ip nat translation *debug ip nat 数据包进入路由器后，路由器先后执行ACL-&gt;路由表-&gt;NAT 2. 广域网协议工作位置：边界路由器的接公网的口（一般是serial口，串行接口），和公网路由器之间；数据包在内网是封装以太帧头，穿过边界路由器时会剥离以太帧头，重新封装广域网链路帧头，广域网没有MAC地址之说。 2.1 HDLCHDLC：High-Level Data Link Control，高级数据链路控制，包含公有的 ISO HDLC和思科私有的 CISCO HDLC。CISCO HDLC 增加一个私有字段，可支持多种协议；ISO HDLC 只支持IP单一协议。思科设备默认是 CISCO HDLC 2.2 PPP2.2.1 协议组成PPP：Point to Point Protocol，点对点协议，包括两个子协议NCP和LCP。NCP：网络核心协议，离网络层近负责网络层协议协商，如封装IP、IPX、APPLETALKLCP：链路控制协议，离数据链路层近负责链路底层协商，如认证方法、压缩方法 2.2.3 协商过程链路两端封装协议一定要一致，不一致会导致protocol down过程： 链路的建立和配置协商，LCP协议协商 链路质量检测，可选的认证过程 网络层协议的配置阶段，NCP协议协商 PPP链路建立 2.2.4 PPP认证支持PAP、CHAP PAP：Password Authentication Protocol，密码验证协议R1—R2R1认证R2，R2会把自己主机名和双方共有密码发给R1做认证。R2认证R1，R1会把自己主机名和双方共有密码发给R2做认证。 CHAP：Challenge Handshake Authentication Protocol，挑战（质询）握手验证协议R1—R2R1认证R2时， R1会将识别质询的ID、R1的Name1、随机数Random发给R2； R2依据Name1查找对应密码Password1，并将ID、Password1、Random通过MD5计算得到Hash2值，将Hash2、ID以及R2的Name2发给R1； R1接收到这个报文后，利用报文中的ID值找到储存在本地数据库中的Random，并根据报文中R2的名称Name2找到本地数据库对应这个名称的密码Password2，然后利用ID、Random、Password2使用MD5算法生成一个Hash1值； Hash1与R2发送过来的Hash2比较，相同则验证通过，发回确认报文，如果不相同则验证失败，发回验证失败报文。 R2认证R1时，同理。 比较： PAPCHAP2次握手3次握手被认证方主动发起主认证方主动发起明文方式传递用户名和密码密码和其他参数做hash后传递都支持单项和双向认证 2.2.5 配置过程12345678910111213141516171819/*R1*/R1(config)#hostname R1R1(config)#username R2 password cisco/*两端密码必需一致，也可单独手工修改指定发给对端的用户名和密码*/R1(config)#int s0/0R1(config-if)#ip add xxR1(config-if)#encapsulation ppp/*思科默认是HDLC封装，需改为PPP*/R1(config-if)#ppp authentication chap/*使用CHAP验证*/R1(config-if)#no shutdown/*R2*/R2(config)#hostname R2R2(config)#username R1 password ciscoR2(config)#int s0/0R2(config-if)#ip add xxR2(config-if)#encapsulation pppR2(config-if)#ppp authentication chapR2(config-if)#no shutdown 校验：123456show ip interface brief/*看接口是否**双up**即可判断是否协商成功*/debug ppp authentication/*校验认证过程*/debug ppp negotiate /*校验全过程*/]]></content>
      <categories>
        <category>网络安全</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>网络</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CCNA简明笔记 4-EIGRP、OSPF、IPv6]]></title>
    <url>%2F2018%2F02%2F01%2FCCNA%E7%AE%80%E6%98%8E%E7%AC%94%E8%AE%B0%204%2F</url>
    <content type="text"><![CDATA[前言 EIGRP的特点、度量值计算和基本配置；OSPF的特点、多区域部署、度量值和基本配置；IPv6的介绍、地址表示形式、分类和路由协议。 1. EIGRPEIGRP：Enhanced IGRP，增强型内部网关路由协议，前身IGRP，其算法是DUAL（弥散修正算法）。 1.1 特征 cisco私有的路由协议 混合型路由协议（距离矢量DV+链路状态LS） 无类别路由协议，发送子网掩码 支持非等开销负载分担 支持路由协议的认证 支持路由手工汇总 1.2 Metric计算公式为：带宽BW、负载Load、可靠性Reliable、延迟Delay，K1、K2、K3、K4、K5是常量。负载Load，可通过show interfaces查看接口Load，会显示load 1/255，意思是255宽的车道跑这一道车。当K5≠0时1Metric=[k1*BW+（k2*BW）/(256-Load)+k3*Delay]*[k5/(k4+Reliable)]*256 当K5=0时1Metric=[k1*BW+（k2*BW）/(256-Load)+k3*Delay]*256 Cisco设备默认值，k1=k3=1,k2=k4=k5=0，于是度量计算可简化为：1Metric=[BW+Delay]*256 可通过命令show ip protocols查看K值；可通过metric weight x x x x修改Metric,但一般不改。带宽BW=10^7/（从源到目标所有路过的三层设备的出站口的最小带宽），单位kbps，1M=10^3bps延迟Delay=（从源到目标所有路过的三层设备的出站口的延迟之和）/10，单位us，1s=10^3us=10^6ms 几种接口带宽：Ethernet：10Mbps，10*10^3Kbps，1000usFastEthernet：100Mbps，100*10^3Kbps，100usLoopback：可通过命令int loopback xx查看修改带宽只影响Metric值计算，只影响逻辑参数，不影响物理参数。 1.3 配置基本配置123456R1(config)#router eigrp 100R1(config-router)#eigrp router-id 1.1.1.1R1(config-router)#no auto-summaryR1(config-router)#network 172.16.1.0 0.0.0.255R1(config-router)#network 0.0.0.0 255.255.255.255/*所有网段都宣告*/ router eigrp 100 100是AS号，自治系统号，Eigrp中理解为域，同域才会建立邻居，同域AS号需一致eigrp router-id 1.1.1.1 id号，相当于路由器的身份证号，id不可重复，格式是IP形式，可手工和自动配置no auto-summary EIGRP和RIPv2默认开启自动路由汇总，会将路由汇总到主类网络network 172.16.1.0 0.0.0.255 EIGRP中可写子类网，要写反向掩码；RIP中的network只能写主类网络号，若不是主类，rip会自动修正network 10.0.0.0 不建议此写法，EIGRP若不写反向掩码，需写主类网络的ip，EIGRP会像RIP一样自动修正为主类网，这样做有可能将其他子网误宣告进去反向掩码，EIGRP的network以及ACL中会用到 校验命令123456show ip eigrp neighborsshow ip eigrp topologyshow ip route eigrpshow ip protocolsclear ip eigrp neighbor/*清除eigrp所有邻接关系*/ show ip eigrp neighbors 邻居表，排错先看邻居show ip eigrp topology 拓扑表，可看度量值和“后继度量值”show ip route eigrp 通过EIGRP学到的路由，可看度量值show ip protocols 查看k值，network命令，是否自动汇总；显示路由器中活跃的路由选择协议当前的参数配置和状态信息 1.4 EIGRP和OSPF中的AS、area、router-id区别当解决EIGRP在大型网络中局限性（最大只支持255跳）的时候需要用到EIGRP中的AS号，意义就是区域，和OSPF的AREA类似，作用是将一个大型网络分割成多个独立的AS，每个AS由一系相邻的路由器所组成，EIGRP建立邻居必须和邻居有相同的AS号，否则邻居建立不成功，无法通信。不同的AS区域间，通过进行路由重发布进行路由的互访。都知道OSPF有RouterID的概念，主要用于标识自己在网络上的名称，唯一标识符，OSPF也通过自动或手动指定的RouterID来最终遴选出DR和BDR。虽然EIGRP要求每台路由器都有RID，但实际的RID值并没有什么实际用途。虽然最好确保EIGRP RID是唯一的，但即使两台路由器的RID相同，它们也能成为邻居。仅当将外部路由注入到EIGRP中时，EIGRP RID才能发挥其作用，在这种情况下，为避免混淆，注入外部路由的路由器必须有唯一的RID。 2. OSPFOSPF：RFC2328，Open SPF，开放最短路径优先协议，SPF是其算法，SPF算法防环路。 2.1 特征 公有协议 链路状态型路由协议 三张表，邻居表 show ip ospf neighbor，链路状态数据库（LSDB，存放的是LSA，eigrp中是拓扑表）show ip ospf database，路由表show ip route ospf 无类别路由协议（发送路由更新时，携带子网掩码） 支持路由协议的认证 支持路由手工汇总 支持多区域的部署结构（eigrp只能一个区域） 2.2 多区域多区域优点：当某链路UpDown路由翻动时，会触发路由泛洪更新，导致SPF频繁计算，为避免SPF频繁运算，OSPF设计出多区域部署；路由翻动时，本区域内路由器会LSA通告促使SPF计算，区域间则是通告路由条目（因此在多区域时，OSPF有距离矢量特性；而在单区域时则是纯链路状态路由协议）多区域部署要求： 必须有area0，也就是backbone（主干）区域 非0区域必须和area0直连（若和非0区域连接，需建立临时virtual link链路，属于临时解决方案） area0不可被打断隔断，即不能多个area0 属于2级部署结构，area0属于level0，其他区域属于level1 2.3 度量值1234Cost=10^8/BW（bps）/*每条链路开销*/Metric=Cost1+Cost2+...+Costn /*每条链路度量值相加*/ 2.4 配置基本配置1234R1(config)#router ospf 100R1(config-router)#router-id 2.2.2.2R1(config-router)#network 10.1.1.0 0.0.0.255 area 0R1(config-router)#network 10.2.2.0 0.0.0.255 area 1 router ospf 100 100属于进程号，每个路由器可不一样，只本地有效，同路由器中不同进程号意味着不同路由协议，需redistribute ospf xxxrouter-id 2.2.2.2 可不写，路由器会自选，一般手写，路由器id不可重复network 10.1.1.0 0.0.0.255 area 0 宣告接口所在区域，同一区域中，所有路由的LSDB表是一样的ospf不存在路由汇总同一个接口只能在一个进程中，不存在自动路由汇总。 多进程12345678910R1(config)#router ospf 100R1(config-router)#router-id 2.2.2.2R1(config-router)#network 10.1.1.0 0.0.0.255 area 0R1(config-router)#redistribute ospf 200R1(config-router)#exitR1(config)#router ospf 200R1(config-router)#router-id 3.3.3.3R1(config-router)#network 10.2.2.0 0.0.0.255 area 1R1(config-router)#redistribute ospf 100R1(config-router)#exit 校验命令12345678show ip protocolsshow ip ospf interfaceshow ip route ospfshow ip ospf neighbordebug ip ospf adj/*show ip ospf interface (可以显示许多详细信息)*/clear ip ospf process/*重启OSPF进程，输入“y”即表示确认重启*/ 2.5 不建邻居原因常见两台直连OSPF路由器不建立邻居的原因： 接口参与不同区域 同链路子网掩码不一致 发送Hello包间隔必须一致 接口认证密码不一样（密码后空格也算作密码一部分，不好排错） 3. IPv6IPv4地址中存在许多特殊用途的保留地址，而且分配不均，导致IPv4不够用；IPv6的出现主要为解决IPv4地址不够用。 3.1 地址表示形式IPv4：4段，每段8位2进制数，共32位二进制数。IPv6：8段，每段4位16进制，共32位16进制，也就是128位二进制数。标准格式：FEC0:0000:97DC:5BA0:0000:0000:0CC0:3EBF压缩格式：FEC0:0:97DC:5BA0::CC0:3EBF一个“ :: ”的省略写法在一个地址IPv6地址中，最多只能出现一次。前导0可以省略，后导0不可省略一段0000可省略为0 3.2 分类可聚合全球单播地址相当于IPv4的公网地址，也就是IPv6公网中可以全世界范围内寻址的地址。范围：2000::/3（2000是16进制，/3表示2进制前3位），其范围是：0010 0000 0000 0000 …=2000:0:0:0:0:0:0:00010 1111 1111 1111 …=3FFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF 本地站点地址相当于IPv4的私有地址，私有网使用范围：FEC0::/10 本地链路地址Ripv1周期广播更新（目的IP是255.255.255.255），Ripv2组播更新（目的IP是224.0.0.9）路由器开启ipv6（命令是ipv6 enable） 会自动生成本地链路地址，路由器发送路由更新的时候，将以出站端口的本地链路（link-local）地址作为源发送路由更新，目的是以FF打头的组播地址；在IPv6网络中，任何一个路由条目的下一跳永远都是直连的对方接口下的link-local地址。该地址类型用于IPv6本地链路的管理用途，自动生成。范围：FE80::/10 未指定地址相当于IPv4的0.0.0.0，客户端DHCP的请求包的源地址范围：::/0 回环地址相当于IPv4的127.0.0.1，本地站点测试范围：::1/128 配置接口IPv6地址12R1(config)#int e0/0R1(config-if)#ipv6 address 2000::1/3 3.3 路由协议IPv6 RIP特点： 组播更新地址FF02::9取代224.0.0.9 以出站端口的link-local地址作为源发送路由更新 IPv4中RIP的UDP源和目标端口都是520，IPv6中的源和目标端口都是UDP521 无路由汇总 配置：1234567R1(config)#ipv6 unicast-routing/*开启IPv6的路由功能*/R1(config)#ipv6 router rip cisco/*cisco字母表示进程号*/R1(config)#int e0/0R1(config-if)#ipv6 rip cisco anable/*相当于rip的网段宣告network*/ 校验：123show ipv6 route ripshow ipv6 protocolsdubug ipv6 rip IPv6 OSPF特点： FF02::5/FF02::6取代224.0.0.5/224.0.0.6 以出站端口的link-local地址作为源发送路由更新LSA IPv4 增加类2种新的LSA（type-8，link-lsa链路lsa;type-9,intra-area-prefix-lsa区内前缀LSA） 配置：12345678R1(config)#ipv6 unicast-routingR1(config)#ipv6 router ospf 99R1(config-rtr)#router-id 1.1.1.1R1(config-rtr)#exitR1(config)#int e0/0R1(config-if)#ipv6 ospf 99 area 0R1(config)#int e0/1R1(config-if)#ipv6 ospf 99 area 1 router-id 1.1.1.1 id一定要配置，格式是ipv4形式，空缺时ipv6不会自动配置（不同于IPv4 OSPF的id），不然无法建立邻居 校验：123456show ipv6 ospf neighborshow ipv6 ospf databaseshow ipv6 route ospfshow ipv6 protocolsshow ipv6 ospf interfacedebug ipv6 ospf adj]]></content>
      <categories>
        <category>网络安全</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>网络</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CCNA简明笔记 3-IP编址、路由协议、静态和RIP路由协议]]></title>
    <url>%2F2018%2F01%2F31%2FCCNA%E7%AE%80%E6%98%8E%E7%AC%94%E8%AE%B0-3%2F</url>
    <content type="text"><![CDATA[前言 二进制基础；IP编址与网络规划（VLSM、CIDR）；路由概述和路由协议分类；静态路由协议；RIP路由协议。 1. 二进制基础2进制-&gt;10进制：2的幂次方求和10011010-&gt;2^7+2^4+2^3+2^1=1542进制-&gt;16进制：4位一组，转16进制10011010-&gt;1001|1010=9A10进制-&gt;2进制：除2取余，反向排序154-&gt;1001101010进制-&gt;16进制：除16取余，反向排序154-&gt;9A16进制-&gt;2进制：每1位对应转换为4位的2进制数9A-&gt;1001|101016进制-&gt;10进制:16的幂次方求和9A-&gt;9*16^1+10*16^0=154 2. IP编址与网络规划2.1 IP编址5类类起始地址范围掩码功能A00.0.0.0-127.255.255.255/8用于Internet的单播通信B10128.0.0.0-191.255.255.255/16C110192.0.0.0-223.255.255.255/24D1110224.0.0.0-239.255.255.255无用于组播E1111240.0.0.0-255.255.255.255无科研保留地址 参照wiki百科0.0.0.0/8属于A类的保留地址，不允许使用127.0.0.0/8属于A类的保留地址，用于loopback环回地址每个网络的可用主机数是2^N-2，N代表可用主机位数，-2是因为全0主机表示网络地址，全1主机表示该网络的广播地址；比如C类地址可用主机位数是8位，那么可用主机数是2^8-2=256-2=254172.16.0.0/16属于主类网络，C类； 172.16.10.0/24属于子类网络； 172.0.0.0/8属于超网 特殊IP网络号主机号SRCDST代表的意思00可以不可本网络上的本主机，主机的DHCP请求时的源地址0.0.0.00host-id可以不可本网络上某个主机host-id全1全1不可可以只在本网络上进行广播（路由器不转发）net-id全1不可可以对net-id网络上的所有主机广播127非全0/非全1可以可以用作本地软件环回测试 SRC表示是否可用于源地址；DST表示是否可用于目的地址 私有IP类私有地址范围掩码A10.0.0.0-10.255.255.255/8B172.16.0.0-172.31.255.255/12C192.168.0.0-192.168.255.255/16 2.2 VLSMCIDR和VLSM都是为打破传统的以类（class）为标准的地址划分方法，缓解IP地址紧缺而出现的VLSM：Variable Length Subnet Mask，可变长子网掩码，就是网络子网化的过程（即2=1+1）；划分的子网都属于同一个主类网络，只是子网掩码长度不一样。VLSM能按照需要的地址数目来分配地址段，最有效的利用现有的地址空间。缺点是：使得路由表变大，消耗硬件资源。VLSM的原理是：根据实际中需要的网络数，从主机位借用一定的位数变为子网位。但到底借用多少位，要从网络数和一个网络内需要的主机数两个角度考虑，兼顾二者。举例有网段172.16.0.0/16，某网络三个区域（每个区域最多120台主机），有三条路由器直连线路，说明需要3个至少包含120个有效主机地址的子网，和3个至少包含2个有效主机地址的子网 子网起始IP最后IP掩码IP个数172.16.00000000.0 0000000172.16.0.0172.16.255.255/162^16=65536172.16.00000000.0|0000000172.16.0.0172.16.0.127/25128172.16.00000000.1|0000000172.16.0.128172.16.0.255/25128172.16.00000001.0|0000000172.16.1.0172.16.1.127/25128172.16.00000001.1|0000000172.16.1.128172.16.1.255/25128172.16.00000010.0|0000000-172.16.11111111.255 剩余IP(2进制)/25172.16.2.0-172.16.255.255 剩余IP(10进制)/2565024172.16.00000001.1|0000000172.16.1.128172.16.1.255/25128172.16.00000001.1|00000|00172.16.1.128172.16.1.131/304172.16.00000001.1|00001|00172.16.1.132172.16.1.135/304172.16.00000001.1|00010|00172.16.1.136172.16.1.139/304172.16.00000001.1|00011|00-172.16.00000001.255 剩余IP(2进制)/3012.16.1.140-172.16.1.255 剩余IP(10进制)/30116 首先将172.16.0.0/16划分出/25（每个子网128个IP）；120台主机的网段只有三个，所以可对第四个子网172.16.1.128/25再划分子网；所得子网中取3个网段用于题中的三条路由器直连线路；两次划分子网都剩余大量未使用的IP地址。IP个数：128+128+128+65024+4+4+4+116=65536 2.3 CIDRCIDR：Classless Inter-Domain Routing，无类别域间路由，可以看成是VLSM的逆过程（1+1=2）,也可以叫做手工路由汇总或超网汇总，取最长的相同位数做掩码。路由汇总减少了路由条目；减轻了CPU和内存的负载，加快了网络收敛的速度，减少了路由翻动的可能性。CIDR不被RIPV1和IGRP支持，因为这两个路由协议只支持自动汇总，并且在传递路由消息时不传递子网掩码，而CIDR需用子网掩码。举例如下5个IP，做汇总 IP1192.68.49.0/24192.68.00110|001.0/24IP2192.68.50.0/24192.68.00110|010.0/24IP3192.68.52.0/24192.68.00110|100.0/24IP4192.68.53.0/24192.68.00110|101.0/24IP5192.68.55.0/24192.68.00110|111.0/24汇总197.68.48.0/21192.68.00110 000.0/21 3. 路由概述和路由协议分类3.1 路由概述路由：数据包在网络中被路由器逐跳转发的过程路由器：用来执行路由功能的设备路由表：用来告诉路由器，数据包应该被如何转发的表路由表获取方式：链路层发现学习本地直连的路由、静态路由学习、动态路由学习路由协议：用来构建路由表中的路由条目的协议路由器路由表匹配原则：最长匹配原则或最精确匹配原则AD值：Administrative Distance，管理距离，路由协议传递路由信息的可信度，值越小越可信；主要用来不同种路由协议之间的选路；AD值是不传递的，本地有效，修改后只影响本机Metric值：度量值，同种路由协议内选路时比较Metric值，值越小越优秀；不同路由协议计算Metric的方法不同；Metric是可传递的，修改本机Metric值后会影响其他机器查看路由表中会看到[AD/Metric]值常见路由协议AD值： 路由协议直连接口静态路由外部BGP内部EIGRPIGRPISISOSPFRIP外部EIGRP内部BGP管理距离012090100115110120170200 3.2 路由协议分类按照获取方式分类链路层发现：直连路由静态路由：普通路由、默认路由动态路由：RIPv1、RIPv2、EIGRP、OSPF、BGP、ISIS、ODR按IP地址类型分类有类路由Classful：RIPv1、IGRP（内部网关路由选择协议）无类路由Classless：RIPv2、EIGRP、OSPF、ISIS、BGP、ODP（CISCO私有）按协议算法分类距离矢量（DV）：Distance Vector Routing Protocol，有RIPv1、RIPv2、BGP链路状态（LS）：Link State Routing Protocol，有OSPF、ISIS、ODR混合型：EIGRP（CISCO私有）按AS分类内部网关协议（IGP）：Interior Gateway Protocol，在AS内部进行工作，有RIPv1、RIPv2、EIGRP、OSPF、ISIS外部网关协议（EGP）：Exterior Gateway Protocol，在AS之间运行的协议，有egp、BGP 3.3 路由协议比较有类别路由协议和无类别路由协议有类别路由协议：发送路由更新时携带子网掩码无类别路由协议：发送路由更新时不携带子网掩码有类路由路由协议的路由汇总会导致路由器被汇总路由欺骗，误认为是等开销负载分担的路径，比如：R1-10.1.1.0-（E1,R2,E2）-10.2.2.0-R3R2会路由汇总，到达10.0.0.0网络可via E1和E2口，以为是等开销负载分担，欺骗路由器静态和动态静态路由Static：需手工配置，不能自动适应网络拓扑结构的改变动态路由Dynamic：能自动适应网络拓扑结构的改变距离矢量、链路状态、混合型距离矢量路由协议：道听途说，直接发送路由表；距离表示你离我有多远；矢量表示方向链路状态路由协议：不发送路由表，发送描述路由的参数；链路表示路由器自身直连的网段；状态表示参数，如ip-address、hello-interval、metric等一些列描述该接口参与路由协议的性能参数混合型路由协议，只有EIGRP（前身是IGRP），比OSPF收敛快，EIGRP主要3个特点： 直接发送路由表（DV的特点） 有3张表，邻居表、拓扑表、路由表（LS的特点） 非等开销负载分担（Rip是等开销负载分担） 距离矢量型路由协议DV链路状态型路由协议LS发送路由条目发送LSA链路状态广播（L&amp;S）不建立邻居关系必须建立邻居关系路由条目是道听途说路由条目是自己计算出来的只有一张路由表邻居表、路由表、拓扑表周期更新、广播更新、完整更新触发更新、组播更新、增量更新 拓扑表保存所有路径；路由表保存最优路径周期更新，每隔30s更新路由条目，各路由器更新间隔不一定同步；广播更新，255.255.255.255；完整更新，发送整张路由表距离矢量路由协议，采用周期更新，导致收敛速度慢，收敛慢会导致路由环路，主要解决方法：水平分割、路由中毒、毒性逆转、计数到无穷大、抑制计时器、触发更新RIPv1和RIPv2RIPv1为有类别路由协议，不支持VLSM和CIDR；以广播的形式发送报文；不支持认证RIPv2为无类别路由协议，支持VLSM，支持路由聚合与CIDR；支持以广播或组播（224.0.0.9）方式发送报文；支持明文认证和MD5密文认证 4. 静态路由静态路由1R1(config)#ip route 172.16.1.0 255.255.255.0 172.16.2.1 172.16.1.0 255.255.255.0 目标网络号和子网掩码172.16.2.1 下一跳路由器直连接口IP，也可配置本路由外出接口数据包有去有回，路由条目也有去有回，注意检查两个方向是否都有路由 默认路由默认路由，也叫缺省路由，静态路由的一种，缺省路由就是在没有找到任何匹配的具体路由条目的情况下才使用的路由。1R1(config)#ip route 0.0.0.0 0.0.0.0 172.16.2.1 5. RIP路由协议123456789R1(config)#router rip R1(config-router)#version 2/*版本2，RIPv2*/R1(config-router)#no auto-summary /*rip默认是开启自动汇总的，需手动关闭*/R1(config-router)#network 172.16.0.0/*宣告参与RIP路由的接口*/R1(config-router)#network 10.0.0.0/*主类网络号*/ network 10.0.0.0 RIP的network宣告，必须写主类网络的形式,不能写子网的形式，比如10.1.1.0/24需要写10.0.0.0EIGRP和RIPv2默认开启自动路由汇总，会将路由汇总到主类网络校验123456show ip protocolsshow ip routedebug ip ripundebug all/*关闭所有debug*/debug all show ip protocols 可以查看更新间隔30s；AD值；可以看接口RIP版本（默认发v1，接受v1和v2）,一般需手工指定v2版本debug all 该命令会打开设备所有debug，极度危险，会使设备卡死]]></content>
      <categories>
        <category>网络安全</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>网络</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CCNA简明笔记 2-路由器&VLAN]]></title>
    <url>%2F2018%2F01%2F30%2FCCNA%E7%AE%80%E6%98%8E%E7%AC%94%E8%AE%B0-2%2F</url>
    <content type="text"><![CDATA[前言 路由器的启动；配置管理；CDP、ping、tracerout；VLAN。 1. 路由器的启动启动顺序 完成POST(加电自检，包括内存和接口) 发现并且加载CISCO IOS软件 寻找并加载路由器的配置文件 如果上述正确完成，那么启动完毕 内部组件RAM(随机存储器) — 执行包缓存，运行当前的配置文件和CISCO IOS，存储路由表的地方。ROM(只读存储器) — 执行POST（加电自检），ROM监控模式，MINI IOS (Rxboot)存储的地方。NVRAM(非易失性随机存储器) — 存储备份配置，配置寄存器(config register)的地方。Flash(闪存) — 存储IOS的地方；它也是非易失性的。它像一个文件系统，比NVRAM昂贵。 寄存器值0x2102：从Flash启动，同时读取NVRAM中的startup-config (工厂默认值)0x2142：从Flash启动，但不使用NVRAM中的startup-config (一般用于口令恢复)配置命令1Route(config)#config-register 0x2102 2. 配置管理路由器模式123456Route&gt;enable/*用户命令模式*/Route#configure terminal/*特权模式*/Route(config)#/*全局配置模式*/ exit逐级退出；end = ctrl+z直接退到“ # ”特权模式；disable从特权模式退到用户命令模式。 保存删除配置1234567891011121314show running-config = write terminalshow startup-configcopy running-config startup-config= write memory= wrerase running-config/*清除配置*/clear ip route */*清除路由表*/ 控制台线路命令12345Router(config)#no ip domain-lookup/*关闭路由器的DNS解析*/Router(config)#line console 0Router(config-line)#logging synchronous/*重新显示中断的控制台输入*/ 路由器DNS解析：假如在CLI下输入了1个Cisco设备不能识别的命令,它会默认通过DNS来进行解析(它认为是主机名)，会话费较长时间而锁死命令行。可以telnet 192.168.1.1或者telnet hostnamexxx，设备会广播解析hostnamexxx。1234Router(config)#line console 0/*设置Console接口密码*/Router(config-line)#password 123456Router(config-line)#login 注意，密码是允许尾部带空格的，不允许首部带空格.ctrl+shift+6+6可以终结一些正在执行的时间较久的命令（如ping、tracertoute） 配置远程登录（VTY）远程登录允许远程通过Telnet、SSH等对路由进行远程访问和管理；路由必须配置特权密码，这样远程用户才能进入特权模式，否则远程用户连接上设备后是无法进入特权模式的。1234Route(config)#line vty 0 4/*设置允许5条并发线路对此路由的远程访问(0-4)*/Route(config-line)#password ccna Route(config-line)#login login作用是要求输入登录密码，如果是no login远程登录将不需要密码。VTY（Virtual Teletype Terminal)虚拟终端。 其他查询1234Route#show ip interface briefRoute#show ip protocols Route#show versionRoute#show interfaces show version 可查看路由器型号，系统版本，映像文件，端口类型，寄存器值等show interfaces 可以查看接口是否双up，以及接口延迟、可靠性、负载、带宽以及MTU等参数 3. CDP、ping、tracerout1234567891011121314151617R1#show cdp entry *R1#ping 10.0.0.1/*测试连通性*/R1#traceroute 3.3.3.3Type escape sequence to abort.Tracing the route to 3.3.3.3 1 10.0.0.1 60 msec 36 msec 12 msec 2 12.0.0.2 !A !A !AR1#traceroute 3.3.3.3 probe 1Type escape sequence to abort.Tracing the route to 3.3.3.3 1 10.0.0.1 28 msec 2 12.0.0.2 !A show cdp entry * 可以查看邻居ID、邻居IP、邻居接口traceroute 默认每一跳尝试3次，通过参数probe可修改次数 4.VLAN4.1 定义VLAN（Virtual Local Area Network），虚拟局域网，将物理上分散的用户，在逻辑上构成一个整体。每个vlan相当于一个子网，一个vlan属于一个广播域。通过vlan创建虚拟工作组，方便管理，并且能分割广播域。 4.2 TrunkTrunk，主干、干道1234567891011121314151617R1(config)#interface fastEthernet 0/0R1(config-if)#switchport mode trunk R1(config-if)#exitR1(config)#exitR1#show interfaces trunk /*查看哪些接口是Trunk类型，极其封装协议*/Port Mode Encapsulation Status Native vlanFa0/0 on 802.1q trunking 1Port Vlans allowed on trunkFa0/0 1-1005Port Vlans allowed and active in management domainFa0/0 1Port Vlans in spanning tree forwarding state and not prunedFa0/0 none 4.3 Trunk链路封装协议主要两种封装协议，ISL和802.1q（dot1q），用在trunk链路上给数据帧打标，用以指明原始数据帧属于哪个vlan。ISL：cisco私有协议，在帧的外部首位添加标记802.1q：**公有协议**，在帧中间插入标记字段12R1(config)#interface fastEthernet 0/0R1(config-if)#switchport trunk encapsulation dot1q 4.4 VTPVTP（VLAN Trunking Protocol）：是VLAN中继协议，思科私有协议，用于设备间动态传递vlan号。有Server、Client、Transparent三种模式。VTP域也称为VLAN管理域，域内的每台交换机都必须使用相同的域名。Server：任何事都可以做，可对VLAN信息增删改，学习和转发相同域名的VTP消息Client：任何事都不能做，除了向Server学习Transparent：可转发VTP消息（透明穿过），自身创建的vlan只本地可见不饿传递，该模式本质是关闭VTP配置Server：123456789101112131415R1#vlan database R1(vlan)#vtp domain ccna/*配置vtp域名为ccna，同域要一致*/R1(vlan)#vtp server /*配置vtp模式*/R1(vlan)#vlan 10R1(vlan)#vlan 20R1(vlan)#exitAPPLY completed.Exiting....R1#/*配置vlan时exit和abort的区别*/R1(vlan)#abort Aborting....R1# exit是保存配置并退出；abort是取消并退出，不保存vlan配置。配置Client：123456R1#vlan database R1(vlan)#vtp domain ccnaR1(vlan)#vtp client R1(vlan)#vlan 10R1(vlan)#vlan 20R1(vlan)#exit 校验:12345show vtp statusshow vlan brief/*真机使用命令*/show vlan-switch brief/*模拟器中的命令*/ 4.5 access-port访问端口1234R1(config)#interface fastEthernet 0/0R1(config-if)#switchport mode accessR1(config-if)#switchport access vlan 22/*指定接口所属的vlan*/]]></content>
      <categories>
        <category>网络安全</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>网络</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CCNA简明笔记 1-分层模型与通信原理]]></title>
    <url>%2F2018%2F01%2F29%2FCCNA%E7%AE%80%E6%98%8E%E7%AC%94%E8%AE%B0%201%2F</url>
    <content type="text"><![CDATA[前言 OSI参考模型以及每一层功能；TCP/IP参考模型、主要包结构以及常见端口号和协议号；网络通信原理。 1. OSI参考模型区分ISO：国际标准化组织（International Organization for Standardization）OSI：开放系统互联（Open System Interconnection）IOS：互联网络操作系统（Internetwork Operating System） 目的开发出OSI参考模型的主要目的是为了解决多厂商设备互联时的兼容问题，使得网络通信简单化、层次化。 模型为方便学习，应用层、表示层、会话层统一叫做应用层。应用层：为用户访问网络提供接口。 代表协议：Telnet、SMTP、HTTP、FTP、tftp、RIP、BGP等。传输层：为数据传输提供可靠或不可靠的连接服务。 代表协议：TCP、UDP、OSPF、EIGRP、GRE等。网络层：IP寻址（逻辑寻址)。 代表协议：IP、ICMP、IGMP等。数据链路层：MAC寻址（物理地址）。 代表协议：Ethernet、HDLC、PPP、Frame-Relay、ATM等。物理层：定义了物理介质的机械和电气特性。如，RJ-45、RJ-11等。 2. 常用包头结构TCP/IP协议族OSI参考模型折中TCP/IP模型应用层应用层应用层表示层会话层传输层传输层传输层网络层网络层Internet层数据链路层数据链路层网络接入层物理层物理层 TCPTCP数据头：20Bytes，10个字段。常见端口号： FTPTelnetSMTPDNS DNS TFTP SNMP RIP 21 23 25 53 53 69 161 520 TCPUDP IPIP数据头：20Bytes，12个字段。常见协议号： TCPUDPEIGRPOSPF6178889 帧数据帧格式：主要两种，DIX Ethernet V2 标准和IEEE 的 802.3 标准。常见协议号： IPv4IPv6ARPSNMPPPP0x08000x86DD0x08060x814C0x880B 3. 通信原理IP地址和MAC地址IP地址：32位，点分十进制。MAC地址：十六进制数表示，共六个字节（48位），其中，前三个字节（高24位）是由IEEE的注册管理机构给不同厂家分配的代码，区分了不同的厂家。 路由交换路由：不同子网间的通信。路由器基于数据包中目标IP地址查路由表，以确定出站口，路由表中保存的是目标网络与出站口之间的映射关系。路由表中如果有多条匹配，坚持最长匹配原则（最精确匹配原则）。交换：同一子网内的通信。交换机基于数据帧的目标MAC地址查找MAC表，MAC地址表中保存的是目标MAC地址与出站口之间的映射关系。ARP：ARP解析请求目的MAC为ff:ff:ff:ff:ff:ff的广播地址，其响应为单播地址，交换机会利用经过自身的ARP数据包动态学习MAC地址。 广播交换机对于广播帧，会全网泛洪（除了接受帧的入向端口）。路由器对于广播包，对于255.255.255.255广播包会丢弃处理。对于子网广播（如，192.168.10.0/24的广播地址192.168.10.255），路由器默认是丢弃的，但可对其配置实现转发。 封装与解封装封装（Encapsulation）：数据发送方负责加封装。解封装（(Decapsulation）：数据接收方负责解封装。 通信原理数据包通信过程中IP保持不变（NAT除外），改变的是MAC地址。传输层是自下而上的第一个端到端的层。IP用于逻辑链路控制，MAC用于物理链路控制。数据链路层和物理层控制物理平面，其数据库为mac-address-table；传输层和网络层控制逻辑平面，其数据库为router-table。 数据包如何穿过网络拓扑图 需求： PC1要与PC2通信。注释： PC1的IP和MAC分别是IP_PC1、MAC_PC1 ，PC2的IP和MAC分别是IP_PC2、MAC_PC2，路由器E1口的IP和MAC分别是IP1_R、MAC1_R，E2口的IP和MAC分别是IP2_R、MAC2_R。通信过程如下： 通过自身子网掩码与目标IP做与运算发现和自己不在同一个网段，属于远程请求，需发到网关； 于是通过ARP询问网关MAC，网关响应请求； PC1发送数据包[IP_PC1,MAC_PC1,IP_PC2,MAC1_R]，发到网关路由器E1口； 路由器查看目的地址是IP_PC2，查找路由表，需走E2口； 路由器封装数据包之前需要知道PC2的MAC地址，通过ARP请求得到； 路由器封装数据包[IP_PC1,MAC2_R,IP_PC2,MAC_PC2]，从E2口扔出； PC2收到数据包，并作出应答。]]></content>
      <categories>
        <category>网络安全</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>网络</tag>
      </tags>
  </entry>
</search>
